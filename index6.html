<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ãƒãƒ¼ã‚¿ãƒ«ã‚µã‚¤ãƒˆç”Ÿæˆãƒ„ãƒ¼ãƒ«</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  :root {
    --bg: #0f172a;
    --card: #0b1120;
    --accent: #38bdf8;
    --accent-soft: rgba(56, 189, 248, 0.15);
    --accent-strong: #06b6d4;
    --border-subtle: rgba(148, 163, 184, 0.35);
    --text-main: #e5e7eb;
    --text-muted: #9ca3af;
    --radius-xl: 18px;
    --shadow-soft: 0 24px 60px rgba(15, 23, 42, 0.75);
  }

  * {
    box-sizing: border-box;
  }

  body {
    margin: 0;
    min-height: 100vh;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    background: radial-gradient(circle at top, #1f2937 0, #020617 55%, #020617 100%);
    color: var(--text-main);
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 32px 16px;
  }

  .app-shell {
    width: 100%;
    max-width: 1120px;
    background: radial-gradient(circle at top left, rgba(56,189,248,0.16), transparent 60%),
                radial-gradient(circle at bottom right, rgba(129,140,248,0.15), transparent 55%),
                linear-gradient(135deg, rgba(15,23,42,0.96), rgba(15,23,42,0.98));
    border-radius: 24px;
    box-shadow: var(--shadow-soft);
    border: 1px solid rgba(148, 163, 184, 0.25);
    padding: 20px 20px 18px;
    position: relative;
    overflow: hidden;
  }

  .app-shell::before {
    content: "";
    position: absolute;
    inset: -40%;
    opacity: 0.25;
    background:
      radial-gradient(circle at 0% 0%, rgba(94,234,212,0.32), transparent 55%),
      radial-gradient(circle at 100% 0%, rgba(59,130,246,0.32), transparent 55%);
    z-index: -1;
  }

  .app-header {
    display: flex;
    justify-content: space-between;
    gap: 16px;
    align-items: center;
    margin-bottom: 16px;
  }

  .app-title-block {
    display: flex;
    flex-direction: column;
    gap: 2px;
  }

  .badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 2px 8px 2px 4px;
    border-radius: 999px;
    border: 1px solid rgba(148, 163, 184, 0.4);
    background: rgba(15, 23, 42, 0.85);
    color: var(--text-muted);
    font-size: 11px;
    letter-spacing: .03em;
    text-transform: uppercase;
  }

  .badge-dot {
    width: 9px;
    height: 9px;
    border-radius: 999px;
    background: radial-gradient(circle, var(--accent-strong), var(--accent));
    box-shadow: 0 0 10px rgba(56,189,248,0.9);
  }

  h1 {
    font-size: 22px;
    margin: 0;
    letter-spacing: .04em;
  }

  .subtitle {
    font-size: 12px;
    color: var(--text-muted);
  }

  .app-actions {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 6px;
    font-size: 11px;
    color: var(--text-muted);
  }

  .pill-info {
    padding: 3px 10px;
    border-radius: 999px;
    background: rgba(15,23,42,0.85);
    border: 1px solid rgba(148,163,184,0.4);
  }

  .pill-info strong {
    color: var(--accent-strong);
  }

  .layout {
    display: grid;
    grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.1fr);
    gap: 16px;
  }

  @media (max-width: 840px) {
    .app-shell {
      padding: 16px 14px 14px;
    }
    .layout {
      grid-template-columns: minmax(0, 1fr);
    }
    .app-header {
      flex-direction: column;
      align-items: flex-start;
    }
    .app-actions {
      align-items: flex-start;
    }
  }

  .panel {
    background: radial-gradient(circle at top left, rgba(148, 163, 184, 0.14), transparent 60%),
                linear-gradient(145deg, rgba(15,23,42,0.98), rgba(15,23,42,0.94));
    border-radius: var(--radius-xl);
    border: 1px solid rgba(148,163,184,0.35);
    padding: 14px 14px 12px;
    position: relative;
    overflow: hidden;
  }

  .panel::before {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: inherit;
    border: 1px solid transparent;
    background: linear-gradient(135deg, rgba(56,189,248,0.2), transparent 60%) border-box;
    mask: linear-gradient(#000 0 0) padding-box, linear-gradient(#000 0 0);
    -webkit-mask-composite: xor;
    mask-composite: exclude;
    opacity: 0.25;
    pointer-events: none;
  }

  .panel-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 10px;
  }

  .panel-title {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 13px;
    letter-spacing: .08em;
    text-transform: uppercase;
    color: var(--text-muted);
  }

  .panel-title-badge {
    width: 18px;
    height: 18px;
    border-radius: 999px;
    background: radial-gradient(circle at 30% 0%, var(--accent-strong), var(--accent));
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 11px;
    color: #0b1120;
    text-shadow: 0 0 4px rgba(15,23,42,0.75);
  }

  .hint {
    font-size: 11px;
    color: var(--text-muted);
  }

  .hint code {
    font-size: 11px;
    background: rgba(15,23,42,0.9);
    padding: 1px 4px;
    border-radius: 999px;
    border: 1px solid rgba(148,163,184,0.5);
  }

  textarea {
    width: 100%;
    min-height: 220px;
    resize: vertical;
    border-radius: 14px;
    border: 1px solid rgba(148,163,184,0.7);
    background: rgba(15,23,42,0.96);
    color: var(--text-main);
    padding: 10px 11px;
    font-family: "SF Mono", ui-monospace, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    font-size: 13px;
    line-height: 1.5;
    outline: none;
    box-shadow: inset 0 0 0 1px rgba(15,23,42,0.85);
  }

  textarea::placeholder {
    color: rgba(148,163,184,0.8);
  }

  .controls-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 8px;
    gap: 8px;
  }

  .controls-left {
    display: flex;
    gap: 8px;
    align-items: center;
  }

  button.primary {
    border: none;
    border-radius: 999px;
    padding: 7px 16px;
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    background: radial-gradient(circle at 0 0, var(--accent-strong), var(--accent));
    color: #0b1120;
    box-shadow: 0 14px 28px rgba(8,47,73,0.7);
    display: inline-flex;
    align-items: center;
    gap: 6px;
    letter-spacing: .04em;
    text-transform: uppercase;
  }

  button.primary:active {
    transform: translateY(1px);
    box-shadow: 0 10px 18px rgba(8,47,73,0.75);
  }

  button.secondary {
    border-radius: 999px;
    border: 1px solid rgba(148,163,184,0.8);
    background: rgba(15,23,42,0.95);
    color: var(--text-main);
    padding: 6px 12px;
    font-size: 12px;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 6px;
  }

  button.secondary:active {
    transform: translateY(1px);
  }

  .status-text {
    font-size: 11px;
    color: var(--text-muted);
  }

  .status-dot {
    width: 8px;
    height: 8px;
    border-radius: 999px;
    margin-right: 4px;
    display: inline-block;
    background: radial-gradient(circle, #4ade80, #16a34a);
    box-shadow: 0 0 10px rgba(34,197,94,0.8);
  }

  .portal-preview-shell {
    border-radius: 14px;
    border: 1px solid rgba(148,163,184,0.6);
    background: radial-gradient(circle at top left, rgba(56,189,248,0.18), transparent 65%),
                linear-gradient(145deg, #020617, #020617);
    padding: 10px 11px;
    min-height: 220px;
    max-height: 320px;
    overflow: auto;
  }

  .portal-outer {
    max-width: 560px;
    margin: 0 auto;
    padding: 12px 10px 14px;
    border-radius: 16px;
    border: 1px solid rgba(55,65,81,0.9);
    background: radial-gradient(circle at top left, rgba(56,189,248,0.18), transparent 60%),
                radial-gradient(circle at bottom right, rgba(99,102,241,0.22), transparent 60%),
                linear-gradient(135deg, #020617, #020617);
    box-shadow: 0 18px 40px rgba(15,23,42,0.9);
  }

  .portal-header {
    display: flex;
    justify-content: space-between;
    gap: 16px;
    align-items: center;
    margin-bottom: 8px;
  }

  .portal-title {
    font-size: 18px;
    letter-spacing: .1em;
    text-transform: uppercase;
    color: var(--text-main);
  }

  .portal-subtitle {
    font-size: 12px;
    color: var(--text-muted);
  }

  .portal-pill {
    font-size: 11px;
    padding: 4px 8px;
    border-radius: 999px;
    border: 1px solid rgba(148,163,184,0.6);
    background: rgba(15,23,42,0.9);
    color: var(--text-muted);
  }

  .portal-section {
    margin-top: 10px;
    padding: 8px 9px;
    border-radius: 12px;
    background: rgba(15,23,42,0.95);
    border: 1px solid rgba(55,65,81,0.9);
  }

  .portal-section h2 {
    margin: 0 0 4px;
    font-size: 15px;
    color: #e5e7eb;
  }

  .portal-section h2 span {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 999px;
    background: rgba(15,23,42,0.9);
    border: 1px solid rgba(148,163,184,0.65);
    font-size: 11px;
    color: var(--text-muted);
    margin-left: 6px;
  }

  .portal-list {
    margin: 4px 0 0;
    padding-left: 16px;
    list-style: none;
  }

  .portal-list li {
    position: relative;
    padding-left: 12px;
    margin: 1px 0;
    font-size: 13px;
  }

  .portal-list li::before {
    content: "â€¢";
    position: absolute;
    left: 0;
    top: 0;
    color: var(--accent-strong);
    font-size: 15px;
  }

  .portal-list a {
    color: #a5b4fc;
    text-decoration: none;
    border-radius: 999px;
    padding: 2px 7px;
    margin-left: -4px;
    transition: background 0.15s, transform 0.05s;
    background: rgba(15,23,42,0.9);
    border: 1px solid transparent;
  }

  .portal-list a:hover {
    background: var(--accent-soft);
    border-color: rgba(56,189,248,0.7);
  }

  .portal-list a:active {
    transform: translateY(1px);
  }

  .bottom-panel {
    margin-top: 8px;
    display: grid;
    grid-template-columns: minmax(0, 1.6fr) minmax(0, 1fr);
    gap: 10px;
    align-items: flex-start;
  }

  @media (max-width: 840px) {
    .bottom-panel {
      grid-template-columns: minmax(0, 1fr);
    }
  }

  .code-label {
    font-size: 11px;
    color: var(--text-muted);
    margin-bottom: 4px;
  }

  #outputHtml {
    min-height: 120px;
    font-size: 12px;
  }

  .footnote {
    font-size: 10.5px;
    color: var(--text-muted);
    margin-top: 4px;
    line-height: 1.4;
  }
</style>
</head>
<body>
<div class="app-shell">
  <header class="app-header">
    <div class="app-title-block">
      <div class="badge">
        <span class="badge-dot"></span> IndexedDB Portal Maker
      </div>
      <h1>ãƒ•ã‚©ãƒ«ãƒ€å†… HTML ãƒãƒ¼ã‚¿ãƒ«ç”Ÿæˆãƒ„ãƒ¼ãƒ«</h1>
      <div class="subtitle">
        ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆã§éšå±¤ã‚’æŒ‡å®šã™ã‚‹ã ã‘ã§ã€åŒä¸€ãƒ•ã‚©ãƒ«ãƒ€å†…ã®ä½œå“ãƒãƒ¼ã‚¿ãƒ«ã‚µã‚¤ãƒˆã‚’è‡ªå‹•ç”Ÿæˆã—ã¾ã™ã€‚
      </div>
    </div>
    <div class="app-actions">
      <div class="pill-info">
        â› <strong>è‡ªå‹•ä¿å­˜</strong>ï¼šå…¥åŠ›å†…å®¹ã¯ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ãƒ–ãƒ©ã‚¦ã‚¶ã«ä¿å­˜ã•ã‚Œã¾ã™
      </div>
      <div>ãƒšãƒ¼ã‚¸ã‚’é–‰ã˜ã¦ã‚‚ã€æ¬¡å›ã“ã®ç”»é¢ã‹ã‚‰å†é–‹ã§ãã¾ã™ã€‚</div>
    </div>
  </header>

  <main class="layout">
    <!-- å·¦ï¼šæ§‹é€ å…¥åŠ› -->
    <section class="panel">
      <div class="panel-header">
        <div class="panel-title">
          <div class="panel-title-badge">IN</div>
          æ§‹é€ ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›
        </div>
        <div class="hint">
          è¦ªè¡Œ + ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆä»˜ãã®å­è¡Œã§æ§‹æˆã—ã¾ã™ã€‚ä¾‹ï¼š<code>å°èª¬A / ï¼ˆå…¨è§’ã‚¹ãƒšãƒ¼ã‚¹ï¼‰å°èª¬A1</code>
        </div>
      </div>
      <textarea id="structureInput" placeholder="ä¾‹ï¼‰&#10;å°èª¬A&#10;ã€€å°èª¬A1&#10;ã€€å°èª¬A2&#10;ã€€å°èª¬A3&#10;å°èª¬B&#10;ã€€å°èª¬B1&#10;ã€€å°èª¬B2"></textarea>

      <div class="controls-row">
        <div class="controls-left">
          <button class="primary" id="generateBtn">
            <span>â–¶</span> ãƒãƒ¼ã‚¿ãƒ«ã‚’ç”Ÿæˆ
          </button>
          <button class="secondary" id="clearBtn" title="å…¥åŠ›å†…å®¹ã‚’ã™ã¹ã¦æ¶ˆå»ã—ã¾ã™">
            âœ• ãƒªã‚»ãƒƒãƒˆ
          </button>
        </div>
        <div class="status-text" id="saveStatus">
          <span class="status-dot"></span> ä¿å­˜æ¸ˆã¿
        </div>
      </div>
    </section>

    <!-- å³ï¼šãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼†ã‚³ãƒ¼ãƒ‰ -->
    <section class="panel">
      <div class="panel-header">
        <div class="panel-title">
          <div class="panel-title-badge">OUT</div>
          ãƒãƒ¼ã‚¿ãƒ«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
        </div>
        <div class="hint">
          ç”Ÿæˆã•ã‚ŒãŸãƒãƒ¼ã‚¿ãƒ«ã¯ã€Œportal.htmlã€ãªã©ã§ä¿å­˜ã—ã€å…ƒã®å°èª¬ HTML ã¨åŒã˜ãƒ•ã‚©ãƒ«ãƒ€ã«ç½®ã„ã¦ãã ã•ã„ã€‚
        </div>
      </div>

      <div class="portal-preview-shell" id="portalPreview">
        <!-- ã“ã“ã«ãƒãƒ¼ã‚¿ãƒ«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒæç”»ã•ã‚Œã¾ã™ -->
      </div>

      <div class="bottom-panel">
        <div>
          <div class="code-label">å®Œæˆãƒãƒ¼ã‚¿ãƒ« HTMLï¼ˆã‚³ãƒ”ãƒ¼ã—ã¦æ–°ã—ã„ .html ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ä¿å­˜ï¼‰</div>
          <textarea id="outputHtml" readonly></textarea>
          <div class="footnote">
            â€» ä¾‹ï¼š<code>portal.html</code> ã¨ã—ã¦ä¿å­˜ã—ã€å°èª¬A1.html ãªã©ã¨åŒã˜ãƒ•ã‚©ãƒ«ãƒ€ã«ç½®ãã¨ãƒªãƒ³ã‚¯ãŒé–‹ã‘ã¾ã™ã€‚
          </div>
        </div>
        <div>
  <button class="secondary" id="copyBtn" style="margin-bottom:6px;">
    ğŸ“‹ ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼
  </button>
  <button class="secondary" id="downloadBtn" style="margin-bottom:6px; display:block; margin-top:2px;">
    ğŸ’¾ portal.html ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
  </button>
  <div class="footnote" id="copyStatus">
    ã‚³ãƒ”ãƒ¼ã—ãŸã‚³ãƒ¼ãƒ‰ã‚’ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒ‡ã‚£ã‚¿ã«è²¼ã‚Šä»˜ã‘ã¦ä¿å­˜ã—ã¦ãã ã•ã„ã€‚
  </div>
  <div class="footnote" id="downloadStatus">
    ç”Ÿæˆã•ã‚ŒãŸ HTML ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ä¿å­˜ã—ãŸã„å ´åˆã¯ã€ä¸Šã®ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚
  </div>
</div>
      </div>
    </section>
  </main>
</div>

<script>
  // IndexedDB è¨­å®š
  const DB_NAME = 'PortalDesignerDB';
  const DB_VERSION = 1;
  const STORE_NAME = 'state';
  let db = null;
  let saveTimer = null;

  const structureInput = document.getElementById('structureInput');
  const saveStatus = document.getElementById('saveStatus');
  const portalPreview = document.getElementById('portalPreview');
  const outputHtml = document.getElementById('outputHtml');
  const copyStatus = document.getElementById('copyStatus');
const downloadStatus = document.getElementById('downloadStatus');

  function setSaveStatus(text, justSaved) {
    saveStatus.textContent = text;
    if (justSaved) {
      saveStatus.style.opacity = '1';
      setTimeout(() => {
        saveStatus.style.opacity = '0.75';
      }, 400);
    }
  }

  function openDatabase() {
    return new Promise((resolve, reject) => {
      const request = indexedDB.open(DB_NAME, DB_VERSION);
      request.onupgradeneeded = function(event) {
        const db = event.target.result;
        if (!db.objectStoreNames.contains(STORE_NAME)) {
          db.createObjectStore(STORE_NAME, { keyPath: 'id' });
        }
      };
      request.onsuccess = function(event) {
        db = event.target.result;
        resolve(db);
      };
      request.onerror = function(event) {
        console.error('IndexedDB error:', event.target.error);
        reject(event.target.error);
      };
    });
  }

  function saveState() {
    if (!db) return;
    const tx = db.transaction(STORE_NAME, 'readwrite');
    const store = tx.objectStore(STORE_NAME);
    const data = {
      id: 'main',
      text: structureInput.value,
      html: outputHtml.value,
      updatedAt: Date.now()
    };
    store.put(data);
    tx.oncomplete = () => {
      setSaveStatus('â› ä¿å­˜æ¸ˆã¿', true);
    };
    tx.onerror = () => {
      setSaveStatus('âš  ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ', false);
    };
  }

  function loadState() {
    if (!db) return;
    const tx = db.transaction(STORE_NAME, 'readonly');
    const store = tx.objectStore(STORE_NAME);
    const request = store.get('main');
    request.onsuccess = () => {
      const data = request.result;
      if (data && typeof data.text === 'string') {
        structureInput.value = data.text;
      }
      if (data && typeof data.html === 'string') {
        outputHtml.value = data.html;
      }
      if (structureInput.value.trim()) {
        generatePortal(); // å‰å›ã®çŠ¶æ…‹ã‹ã‚‰å†ç”Ÿæˆ
      }
    };
  }

  function escapeHtml(str) {
    return str.replace(/[&<>"']/g, function(m) {
      switch (m) {
        case '&': return '&amp;';
        case '<': return '&lt;';
        case '>': return '&gt;';
        case '"': return '&quot;';
        case "'": return '&#39;';
        default: return m;
      }
    });
  }

  function parseStructure(text) {
    const lines = text.split(/\r?\n/);
    const sections = [];
    let current = null;

    for (let rawLine of lines) {
      const line = rawLine.replace(/\t/g, '    '); // ã‚¿ãƒ–ã‚’ã‚¹ãƒšãƒ¼ã‚¹æ‰±ã„
      const trimmed = line.trim();
      if (!trimmed) continue;

      const isChild = /^\s+/.test(line);

      if (!isChild) {
        current = { title: trimmed, items: [] };
        sections.push(current);
      } else if (current) {
        current.items.push(trimmed);
      }
    }
    return sections;
  }

  function buildPortalBody(sections) {
    if (!sections.length) {
      return (
        '<div class="portal-outer">' +
        '<div class="portal-header">' +
        '<div>' +
        '<div class="portal-title">PORTAL PREVIEW</div>' +
        '<div class="portal-subtitle">å·¦ã®ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã«æ§‹é€ ã‚’å…¥åŠ›ã—ã¦ã€Œãƒãƒ¼ã‚¿ãƒ«ã‚’ç”Ÿæˆã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚</div>' +
        '</div>' +
        '<div class="portal-pill">ã¾ã ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒã‚ã‚Šã¾ã›ã‚“</div>' +
        '</div>' +
        '</div>'
      );
    }

    let body = '<div class="portal-outer">';
    body += '<div class="portal-header">' +
            '<div>' +
            '<div class="portal-title">WORKS PORTAL</div>' +
            '<div class="portal-subtitle">åŒä¸€ãƒ•ã‚©ãƒ«ãƒ€å†…ã® HTML ä½œå“ã¸ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒšãƒ¼ã‚¸</div>' +
            '</div>' +
            '<div class="portal-pill">' + sections.length + ' ã‚»ã‚¯ã‚·ãƒ§ãƒ³</div>' +
            '</div>';

    sections.forEach(sec => {
      body += '<section class="portal-section">';
      const count = sec.items.length;
      body += '<h2>' + escapeHtml(sec.title);
      if (count > 0) {
        body += '<span>' + count + ' ãƒšãƒ¼ã‚¸</span>';
      }
      body += '</h2>';

      if (count > 0) {
        body += '<ul class="portal-list">';
        sec.items.forEach(item => {
          const fileName = item + '.html'; // åŒãƒ•ã‚©ãƒ«ãƒ€æƒ³å®š
          const href = encodeURI(fileName);
          body += '<li><a href="' + href + '">' + escapeHtml(item) + '</a></li>';
        });
        body += '</ul>';
      }
      body += '</section>';
    });

    body += '</div>';
    return body;
  }

  function generatePortal() {
    const text = structureInput.value || '';
    const sections = parseStructure(text);
    const portalBody = buildPortalBody(sections);

    portalPreview.innerHTML = portalBody;

    const fullHtml =
`<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ä½œå“ãƒãƒ¼ã‚¿ãƒ«</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body {
    margin: 0;
    min-height: 100vh;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    background: radial-gradient(circle at top, #111827 0, #020617 55%, #020617 100%);
    color: #e5e7eb;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    padding: 32px 16px;
  }
  .portal-outer {
    max-width: 720px;
    width: 100%;
    padding: 16px 18px 18px;
    border-radius: 20px;
    border: 1px solid rgba(55,65,81,0.9);
    background:
      radial-gradient(circle at top left, rgba(56,189,248,0.18), transparent 60%),
      radial-gradient(circle at bottom right, rgba(99,102,241,0.22), transparent 60%),
      linear-gradient(135deg, #020617, #020617);
    box-shadow: 0 18px 40px rgba(15,23,42,0.9);
  }
  .portal-header {
    display: flex;
    justify-content: space-between;
    gap: 16px;
    align-items: center;
    margin-bottom: 10px;
  }
  .portal-title {
    font-size: 20px;
    letter-spacing: .12em;
    text-transform: uppercase;
  }
  .portal-subtitle {
    font-size: 12px;
    color: #9ca3af;
  }
  .portal-pill {
    font-size: 11px;
    padding: 4px 10px;
    border-radius: 999px;
    border: 1px solid rgba(148,163,184,0.6);
    background: rgba(15,23,42,0.9);
    color: #e5e7eb;
  }
  .portal-section {
    margin-top: 12px;
    padding: 9px 10px;
    border-radius: 14px;
    background: rgba(15,23,42,0.96);
    border: 1px solid rgba(55,65,81,0.9);
  }
  .portal-section h2 {
    margin: 0 0 6px;
    font-size: 16px;
  }
  .portal-section h2 span {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 999px;
    background: rgba(15,23,42,0.9);
    border: 1px solid rgba(148,163,184,0.65);
    font-size: 11px;
    color: #9ca3af;
    margin-left: 6px;
  }
  .portal-list {
    margin: 4px 0 0;
    padding-left: 18px;
    list-style: none;
  }
  .portal-list li {
    position: relative;
    padding-left: 12px;
    margin: 2px 0;
    font-size: 14px;
  }
  .portal-list li::before {
    content: "â€¢";
    position: absolute;
    left: 0;
    top: 0;
    color: #06b6d4;
    font-size: 17px;
  }
  .portal-list a {
    color: #a5b4fc;
    text-decoration: none;
    border-radius: 999px;
    padding: 3px 8px;
    margin-left: -4px;
    transition: background 0.15s, transform 0.05s;
    background: rgba(15,23,42,0.9);
    border: 1px solid transparent;
  }
  .portal-list a:hover {
    background: rgba(56,189,248,0.14);
    border-color: rgba(56,189,248,0.7);
  }
  .portal-list a:active {
    transform: translateY(1px);
  }
</style>
</head>
<body>
${portalBody}
</body>
</html>`;

    outputHtml.value = fullHtml;

    // ç”Ÿæˆå¾Œã«ä¿å­˜
    saveState();
  }

  function setupEvents() {
    structureInput.addEventListener('input', () => {
      setSaveStatus('â³ ä¿å­˜å¾…ã¡â€¦', false);
      if (saveTimer) clearTimeout(saveTimer);
      saveTimer = setTimeout(saveState, 400);
    });

    document.getElementById('generateBtn').addEventListener('click', () => {
      generatePortal();
    });

    document.getElementById('clearBtn').addEventListener('click', () => {
      if (structureInput.value.trim() &&
          !confirm('å…¥åŠ›å†…å®¹ã‚’ã™ã¹ã¦æ¶ˆå»ã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')) {
        return;
      }
      structureInput.value = '';
      outputHtml.value = '';
      portalPreview.innerHTML = '';
      saveState();
    });

    document.getElementById('copyBtn').addEventListener('click', async () => {
      const text = outputHtml.value;
      if (!text.trim()) {
        copyStatus.textContent = 'ã¾ã  HTML ãŒç”Ÿæˆã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã¾ãšã€Œãƒãƒ¼ã‚¿ãƒ«ã‚’ç”Ÿæˆã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚';
        return;
      }
      try {
        await navigator.clipboard.writeText(text);
        copyStatus.textContent = 'âœ… ã‚³ãƒ¼ãƒ‰ã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸã€‚ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒ‡ã‚£ã‚¿ã«è²¼ã‚Šä»˜ã‘ã¦ä¿å­˜ã—ã¦ãã ã•ã„ã€‚';
      } catch (e) {
        copyStatus.textContent = 'âš  ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ‰‹å‹•ã§é¸æŠã—ã¦ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„ã€‚';
      }
    });

document.getElementById('downloadBtn').addEventListener('click', () => {
  const text = outputHtml.value;
  if (!text.trim()) {
    downloadStatus.textContent = 'ã¾ã  HTML ãŒç”Ÿæˆã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã¾ãšã€Œãƒãƒ¼ã‚¿ãƒ«ã‚’ç”Ÿæˆã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚';
    return;
  }
  try {
    const blob = new Blob([text], { type: 'text/html;charset=utf-8' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'portal.html';
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
    downloadStatus.textContent = 'âœ… portal.html ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸã€‚';
  } catch (e) {
    console.error(e);
    downloadStatus.textContent = 'âš  ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã®åˆ¶é™ãŒåŸå› ã®å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚';
  }
});
  }

  window.addEventListener('DOMContentLoaded', async () => {
    try {
      await openDatabase();
      loadState();
      setSaveStatus('â› ä¿å­˜æ¸ˆã¿', false);
    } catch (e) {
      setSaveStatus('âš  ä¿å­˜æ©Ÿèƒ½ãŒç„¡åŠ¹ã§ã™ï¼ˆIndexedDB ã‚¨ãƒ©ãƒ¼ï¼‰', false);
    }
    setupEvents();
  });
</script>
</body>
</html>
